<html lang="en">

<head>
    <title> HealWise </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<style>
  body.dark-mode {
    background-color: #121212;
    color: #f1f1f1;
  }
  body.dark-mode .w3-bar, 
  body.dark-mode .form-control, 
  body.dark-mode .btn, 
  body.dark-mode input, 
  body.dark-mode label {
    background-color: #1e1e1e !important;
    color: #f1f1f1 !important;
  }
</style>


<style>
  body {
    background-color: #e6f2f8;
    color: #333;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }
  .w3-bar, .form-control, .btn, input, label {
    background-color: #ffffff;
    color: #333;
  }
  .btn {
    border: 1px solid #4aa3df;
    background-color: #4aa3df;
    color: white;
  }
  .btn:hover {
    background-color: #2c90d3;
  }
  .highlight-box {
    border: 2px solid #4aa3df;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    background-color: #f9fcff;
  }

  body.dark-mode {
    background-color: #0f172a;
    color: #f1f1f1;
  }
  body.dark-mode .w3-bar, 
  body.dark-mode .form-control, 
  body.dark-mode .btn, 
  body.dark-mode input, 
  body.dark-mode label {
    background-color: #1e293b !important;
    color: #f1f1f1 !important;
  }
</style>

</head>

<body onload="readyfn(this)">

<div style="position: fixed; top: 10px; right: 20px; z-index: 9999;">
    <button onclick="toggleDarkMode()" class="btn btn-dark">Toggle Dark Mode</button>
</div>




<div class="highlight-box" style="text-align:center;">
    <h4>Your Health, Our Priority</h4>
    <img src="1.png" 
         alt="Public Health" 
         style="max-width: 10%; height: auto; margin-top: 15px; border-radius: 10px;">
</div>


    <div style="background-color: #202D30; min-height: 45px;padding-left: 10px; padding-right: 10px;">
        <div style="float: left; width: 50%;">
            <img alt="Braintoy Logo" border="0" class="float: left;"
                src="https://static.wixstatic.com/media/1a4da9_cd056aab6d754dae98dc60083c4317a8~mv2.png"
                style="text-decoration: none; -ms-interpolation-mode: bicubic; height: auto; border: none; width: 100%; max-width: 150px; display: block;"
                title="Braintoy Logo" width="200" />
        </div>
        <div style="float: right; width: 50%; ">
            <span style="color: white; float: right; font-size: 30px;"> HealWise </span>
        </div>
    </div>
    <div class="w3-bar" style=" padding: 20px;">
        <div class="w3-half" style="min-height: 880px;padding: 10px;">
            <div class="w3-bar">
                <h3>Input(s) to the model</h3>
            </div>
            <div class="w3-bar" style="border: 1px solid lightblue ; padding: 10px; border-radius: 10px; ">
                <div class="w3-bar" style="min-height: 800px;max-height: 800px; overflow-y: auto;">
                    <div id="id_mlos_prediction">
                        <div class="form-group"><label for="Age">Age:</label> <input type="text" value ="47" id="input_feature_1" class="form-control"  name="Age"></div><div class="form-group"><label for="Sex">Sex:</label> <input type="text" value ="M" id="input_feature_2" class="form-control"  name="Sex"></div><div class="form-group"><label for="BP">BP:</label> <input type="text" value ="LOW" id="input_feature_3" class="form-control"  name="BP"></div><div class="form-group"><label for="Cholesterol">Cholesterol:</label> <input type="text" value ="HIGH" id="input_feature_4" class="form-control"  name="Cholesterol"></div><div class="form-group"><label for="Na_to_K">Na_to_K:</label> <input type="text" value ="13.093" id="input_feature_5" class="form-control"  name="Na_to_K"></div>

                    </div>
                </div>
            </div>
        </div>
        <div class="w3-half" style="min-height: 880px;padding: 10px;">
            <div id="id_hide_if_api_key_embedded" class="w3-bar w3-show">
                <div class="w3-bar">
                    <h3>API Key</h3>
                </div>
                <div class="w3-bar" style="border: 1px solid lightblue ; padding: 10px; border-radius: 10px; ">
                    <div class="w3-bar" style="min-height: 100px;max-height: 800px; overflow-y: auto;">
                        <div id="id_mlos_prediction">
                            <div class="form-group">
                                <label for="apikey">apikey:</label>
                                <input type="password" value="_apikey_" id="apikey" class="form-control" name="apikey">
                            </div>
                            <div class="form-group">
                                <label for="accesstoken">accesstoken:</label>
                                <input type="password" value="_accesstoken_" id="accesstoken" class="form-control"
                                    name="accesstoken">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w3-bar">
                <h3>Model Output</h3>
            </div>
            <div class="w3-bar" style="border: 1px solid lightblue ; padding: 10px; border-radius: 10px;">
                <div id="id_warning_val" class="w3-bar w3-hide">
                    <span id="id_msg_container" style="color: orange;font-size: 14px; "> Invalid APIkey or Access Token,
                        Please change APIkey.
                    </span>
                </div>
                <div class="w3-bar" style="padding-left: 350px;padding-right: 150px;">
                    <button onclick="btn_click_predict(this)" class="btn btn-default w3-left">Predict</button>
                </div>
                <div class="w3-bar" style="padding-top: 30px;padding-left: 100px;padding-right: 100px;">
                    <div class="w3-half" style="padding: 15px;">
                        <span style="font-size: 18px;">Response From Model</span>
                        <div class="w3-bar " style="border: 1px solid lightblue; border-radius: 10px; padding: 20px;">
                            <span id="id_response_1" style="font-size: 18px;">[]</span>
                        </div>
                    </div>
                    <div class="w3-half" style="padding: 15px;">
                        <span style="font-size: 18px;"> Transformed Response</span>
                        <div class="w3-bar " style="border: 1px solid lightblue; border-radius: 10px;padding: 20px;">
                            <span id="id_response_2" style="font-size: 18px;">[]</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w3-bar">
                <div class="w3-half" style="padding: 3px;">
                    <div class="w3-bar">
                        <h3>Model Response Log</h3>
                    </div>
                    <div class="w3-bar"
                        style="border: 1px solid lightblue ; padding: 10px; border-radius: 10px; margin-top: 10px; max-height: 300px; min-height: 300px; overflow-y: auto;">
                        <div id="id_mlos_predict_log">

                        </div>
                    </div>
                </div>
                <div class="w3-half" style="padding: 3px;">
                    <div class="w3-bar">
                        <h3>Why ?</h3>
                    </div>
                    <div class="w3-bar"
                        style="border: 1px solid lightblue ; padding: 10px; border-radius: 10px; margin-top: 10px; max-height: 300px; min-height: 300px; overflow-y: auto;">
                        <div class="w3-bar">
                            <span > Probabilistic Prediction  </span>
                        </div>
                        <div class="w3-bar">
                            <div class="w3-bar" id="id_model_explain_prob">

                            </div>
                        </div>
                        <div class="w3-bar">
                            <div class="w3-bar">
                                <div class="w3-bar" style="border-bottom: 1px solid green;">
                                    <span>Influential Inputs</span>
                                </div>
                                <div class="w3-bar" id="id_model_explain_response_good">

                                </div>
                            </div>
                            <div class="w3-bar">
                                <div class="w3-bar " style="border-bottom: 1px solid red;">
                                    <span>Noninfluential Inputs</span>
                                </div>
                                <div class="w3-bar" id="id_model_explain_response_bad">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>


    
<div class="w3-bar" style="padding: 20px;">
    <h4 style="text-align:center;">Prediction Probability Chart</h4>
    <canvas id="probabilityChart" style="width:100%;max-width:500px;margin:auto;"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('probabilityChart').getContext('2d');
    const probabilityChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['DrugA', 'DrugB', 'DrugC'],
            datasets: [{
                label: 'Probability',
                data: [0.3, 0.5, 0.2],
                backgroundColor: ['#4CAF50', '#2196F3', '#FFC107']
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1
                }
            }
        }
    });
</script>



<div style="padding: 40px; background-color: #f9f9f9; border-top: 1px solid #ccc; text-align: center;">
    <h4>Understanding the Features</h4>
    <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 40px; margin-top: 20px;">
        <div style="display: flex; flex-direction: column; align-items: center; width: 150px;">
            <img src="4994683.png" alt="Age" style="width: 60px; height: 60px; object-fit: contain;" />
            <p style="margin-top: 10px;">Age of the Patient</p>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; width: 150px;">
            <img src="https://img.icons8.com/doodle/64/000000/gender-neutral-user.png" alt="Sex" style="width: 60px; height: 60px; object-fit: contain;" />
            <p style="margin-top: 10px;">Sex of the Patient</p>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; width: 150px;">
            <img src="dad337e5-8ec9-4d47-a2ba-4d5f3bc61b22.png" alt="BP" style="width: 60px; height: 60px; object-fit: contain;" />
            <p style="margin-top: 10px;">Blood Pressure Level</p>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; width: 150px;">
            <img src="Screenshot 2025-04-10 at 12.10.54 PM.png" alt="Cholesterol" style="width: 60px; height: 60px; object-fit: contain;" />
            <p style="margin-top: 10px;">Cholesterol Level</p>
        </div>
    </div>
</div>
<div style="background-color: #202D30; min-height: 30px;padding-left: 10px; padding-right: 10px;top: 100%;">
        &nbsp;
    </div>

<script>
  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
  }
</script>

</body>
<script>
    var feature_list = {"columns": ["Age", "Sex", "BP", "Cholesterol", "Na_to_K"], "index": [0, 1, 2], "data": [[23, "F", "HIGH", "HIGH", 25.355], [47, "M", "LOW", "HIGH", 13.093], [47, "M", "LOW", "HIGH", 10.114]]}
    var data_domain = "table"
    var apikey = "1e296efba6944313ade865c8ba968f541795b83f06204e93a4c058814112e7d2"
    var accesstoken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJBIjoiQV9qcDc1NzcxOTVnbWFpbGNvbV9mZThiZGY5NzFkM2Y0NzVlYmFhNTYyNmNhYzhmZDc1NSJ9.CMJUiM6sq6DxgdvOIZBSgqMwr7qOTX5sDh1RdISO2Ho"
    if (apikey == "1e296efba6944313ade865c8ba968f541795b83f06204e93a4c058814112e7d2" && accesstoken == "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJBIjoiQV9qcDc1NzcxOTVnbWFpbGNvbV9mZThiZGY5NzFkM2Y0NzVlYmFhNTYyNmNhYzhmZDc1NSJ9.CMJUiM6sq6DxgdvOIZBSgqMwr7qOTX5sDh1RdISO2Ho") {
        itm = document.getElementById("id_hide_if_api_key_embedded")
        itm.className = itm.className.replace("w3-hide", "w3-show")
    }
    else {
        itm = document.getElementById("id_hide_if_api_key_embedded")
        itm.className = itm.className.replace("w3-show", "w3-hide")
    }
    document.getElementById("apikey").value = apikey
    document.getElementById("accesstoken").value = accesstoken
    var req_count = 1
    function readyfn() {
    }
    function show() {
        itm = document.getElementById("id_warning_val")
        itm.className = itm.className.replace("w3-hide", "w3-show")
    }
    function hide() {
        itm = document.getElementById("id_warning_val")
        itm.className = itm.className.replace("w3-show", "w3-hide")
    }
    function btn_click_predict(e) {
        apikey = document.getElementById("apikey").value
        accesstoken = document.getElementById("accesstoken").value
        if (apikey == "_apikey_") {
            show()
            itm = document.getElementById("id_mlos_predict_log")
            spn = document.createElement("div")
            spn.setAttribute("class", "w3-bar")
            spn.innerHTML = "[" + req_count + "]" + " - Unauthorized "
            itm.insertBefore(spn, itm.childNodes[0]);
            req_count = req_count + 1
            return
        }
        else {
            hide()
        }

        var num_features = feature_list["columns"].length
        var data = {
            "data": []
        };
        var feature_important_list = []
        inc = 1
dtx = []
feature_list["columns"].forEach(element => {
tmp = {
"feature": element,
"id": "input_feature_" + inc,
"weight": 0,
"target": 0
}
feature_important_list.push(tmp)
itmv = document.getElementById("input_feature_" + inc).value
dtx.push(itmv)
inc = inc + 1
});
data["data"].push(dtx)
        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;
        xhr.addEventListener("readystatechange", function () {
            if (this.readyState === 4) {
                resp = []
                try {
                    resp = JSON.parse(this.responseText)

                } catch (error) {
                    itm = document.getElementById("id_mlos_predict_log")
                    spn = document.createElement("div")
                    spn.setAttribute("class", "w3-bar")
                    spn.innerHTML = "[" + req_count + "]" + " - Unauthorized "
                    itm.insertBefore(spn, itm.childNodes[0]);
                }
                if (resp.success == true) {
                    mresp = resp.results.results
                    console.log(mresp)
                    sample_response = mresp.prediction[0]
                    document.getElementById("id_response_1").innerHTML = mresp.prediction[0]
                    document.getElementById("id_response_2").innerHTML = mresp.prediction_transformed[0]
                    itm = document.getElementById("id_mlos_predict_log")
                    spn = document.createElement("div")
                    spn.setAttribute("class", "w3-bar")
                    spn.innerHTML = "[" + req_count + "]" + "MODEL RESPONSE " + mresp.prediction_transformed[0]
                    itm.insertBefore(spn, itm.childNodes[0]);

                    response_explanation = mresp.explanation

                    itm = document.getElementById("id_model_explain_response_bad")
                    itm.innerHTML = ""
                    itm = document.getElementById("id_model_explain_response_good")
                    itm.innerHTML = ""


                    feature_important_list.forEach(element => {
                        response_explanation.forEach(expln => {
                            if (element.feature == expln.feature) {
                                element.weight = expln.weight
                                element.target = expln.target
                                if (expln.normweight > 0.2) {
                                    moditem = document.getElementById(element.id)
                                    moditem.setAttribute("style", "border-bottom:2px solid green;line-height: 50px;")
                                    itm = document.getElementById("id_model_explain_response_good")
                                    spn = document.createElement("span")
                                    spn.setAttribute("class", "w3-block ")
                                    spn.setAttribute("style", "color:green;")
                                    spn.innerHTML = element.feature + " [ " +  expln.weight +   " ] "
                                    itm.insertBefore(spn, itm.childNodes[0]);
                                }
                                else {
                                    moditem = document.getElementById(element.id)
                                    moditem.setAttribute("style", "border-bottom:2px solid red;line-height: 50px;")
                                    itm = document.getElementById("id_model_explain_response_bad")
                                    spn = document.createElement("span")
                                    spn.setAttribute("style", "color:red;")
                                    spn.setAttribute("class", "w3-block")
                                    spn.innerHTML = element.feature + " [ " +  expln.weight +   " ] "
                                    itm.insertBefore(spn, itm.childNodes[0]);
                                }
                            }
                        })
                    })


                    class_label = mresp["class_label"]
                        probability = mresp["probability"][0]
                        if (class_label.length > 0 && probability.length > 0) {
                            inc = 0
                            min = Math.min(probability)
                            max = Math.max(probability)
                            // valx= probability.map(this.normalize(min, max))
                            // // valx= probability-min
                            // console.log(valx)
                            itm = document.getElementById ("id_model_explain_prob")
                            itm.innerHTML = ""
                            class_label.forEach(elm => {

                                spn = document.createElement("span")
                                spn.setAttribute("class", "w3-block win-act-color")
                                spn.setAttribute("style", "color:green;")
                                spn.innerHTML = elm + " [ " + probability[inc] + " ] "
                                itm.appendChild(spn);
                                inc = inc + 1
                            })
                        }
                        else {
                            itm = document.getElementById ("id_model_explain_prob")
                            itm.innerHTML = "No class probability available."
                        }



                }
                else {
                    itm = document.getElementById("id_mlos_predict_log")
                    spn = document.createElement("div")
                    spn.setAttribute("class", "w3-bar")
                    spn.innerHTML = "[" + req_count + "]" + " - ERROR IN MODEL RESPONSE "
                    itm.insertBefore(spn, itm.childNodes[0]);
                }
                req_count = req_count + 1

            }


        });
        xhr.open("POST", "https://www.console.mlos.io/api/v1/mlasaservice");
        xhr.setRequestHeader("content-type", "application/json");
        xhr.setRequestHeader("authorization", accesstoken);
        xhr.setRequestHeader("apikey", apikey);
        xhr.setRequestHeader("api", "predict");
        xhr.setRequestHeader("cache-control", "no-cache");
        xhr.setRequestHeader("Access-Control-Allow-Origin", "http://127.0.0.1:8080");
        // xhr.setRequestHeader("Access-Control-Content-Type", "*");
        // xhr.setRequestHeader("Access-Control-Allow-Credentials", true);


        xhr.setRequestHeader("app-token", "asdasda-asdasd-c8fd-da41-dd36d45914fc");
        data = JSON.stringify(data)
        xhr.send(data);
    }
    

</script>

</html>